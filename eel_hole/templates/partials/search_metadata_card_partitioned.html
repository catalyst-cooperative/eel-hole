<div
  class="block"
  x-data='{ selectedPartition: "", downloadPaths: {{ r.download_paths | tojson | safe }} }'
>
  <div class="level">
    <div class="level-left">
      <label for="partition">Select a partition to preview or download:</label>
      <div class="select">
        <select id="partition" x-model="selectedPartition">
          <option value="" selected>Select a partition...</option>
          {% for part in r.preview_paths %}
            {%
              set parsed_part =
              part.split('/')[-1].split('.')[0]
            %}
            <option value="{{ parsed_part }}">{{ parsed_part }}</option>
          {% endfor %}
        </select>
      </div>
    </div>
  </div>
  <div class="level">
    <div class="level-left">
      <span class="has-text-weight-bold has-text-warning"
        >Note: some partitioned tables are quite large and may take several
        minutes to load a preview.</span
      >
    </div>
  </div>

  {% if current_user.is_authenticated %}
    <a
      class="button is-primary preview-button"
      :disabled="!selectedPartition"
      :href="selectedPartition ? '/preview/{{ r.package }}/{{ r.name }}/' + selectedPartition + '?return_q={{ request.args.get("q") }}': '#'"
      >Preview / export as CSV</a
    >
  {% else %}
    <a
      class="button is-primary preview-button"
      :disabled="!selectedPartition"
      href="/login?next_url={{ url_for(request.endpoint, **request.args) }}"
      >Log in or sign up to preview / export as CSV</a
    >
  {% endif %}
  <a
    class="button is-link is-light"
    :disabled="!selectedPartition"
    :href="selectedPartition ? downloadPaths[selectedPartition] : '#'"
    >Download full table as Parquet</a
  >
</div>
