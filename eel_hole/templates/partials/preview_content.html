<!-- title tag here so HTMX request updates page title -->
<title>
    {{ resource.name }}{{ " - {}".format(partition) if partition }} - PUDL Data
    Viewer
</title>

<div class="container is-fluid">
    <div class="level">
        <div class="level-left">
            <h2 class="title is-4 level-item" data-testid="metadata-table-name">
                {{resource.name}}{{ " - {}".format(partition) if partition }}
            </h2>
        </div>
        <div class="level-right">
            <span class="tag level-item">package: {{ resource.package }}</span>
            {% if resource.package == "pudl" %} {% if
            not(current_user.is_authenticated) %}
            <a
                class="button is-primary preview-button level-item"
                href="/login?next_url={{ request.full_path }}"
                >Log in or sign up to preview / export as CSV</a
            >
            {% endif %}
            <a
                class="button is-link is-light level-item"
                href="{{ resource.download_path }}"
                >Download full table as Parquet</a
            >
            {% endif %}
        </div>
    </div>
    <div
        class="columns is-flex-grow-1"
        x-data="previewTableState('{{ resource.name }}', '{{ resource.preview_path }}')"
    >
        <div
            class="data-dictionary column my-3 is-flex is-flex-direction-column"
        >
            <div class="data-dictionary is-flex-grow-1" id="sidebar">
                {% include 'partials/preview_metadata_card.html' %}
            </div>
        </div>
        {% if current_user.is_authenticated %}
        <div
            class="preview-panel mt-3 mb-5 box column is-two-thirds is-flex-direction-column"
        >
            <div class="level">
                <div class="level-left">
                    <h3 x-show="numRowsMatched === null" class="subtitle is-6">
                        Loading data...
                    </h3>
                    <h3 x-show="numRowsMatched !== null" class="subtitle is-6">
                        Showing
                        <span
                            class="has-text-weight-bold"
                            x-text="numRowsDisplayed.toLocaleString()"
                        ></span>
                        rows out of
                        <span
                            class="has-text-weight-bold"
                            :class="{'has-text-warning': numRowsDisplayed < numRowsMatched}"
                            x-text="numRowsMatched?.toLocaleString()"
                        ></span>
                        rows that match your filters
                    </h3>
                </div>
                <div class="level-right">
                    <button
                        class="button level-item is-primary"
                        :disabled="exporting || !csvAllowed()"
                        @click="exportCsv"
                        :class="{'is-loading': exporting}"
                        x-text="csvText()"
                        x-show="numRowsMatched !== null"
                    ></button>
                </div>
            </div>
            <div id="data-table" class="is-flex-grow-1"></div>
        </div>
        {% endif %}
    </div>
</div>
