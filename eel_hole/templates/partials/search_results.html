{% for r in resources %}
<div class="block" data-testid="{{r.name}}">
  <div class="level">
    <div class="level-left">
      <h2 class="title is-4 level-item">{{r.name}}</h2>
    </div>
  </div>
  <div class="level">
    <div class="level-left">
      <span class="tag level-item">package: {{ r.package }}</span>
    </div>
  </div>
  {% if r.package == "pudl" %}
  <div class="block">
      {% if r.path is iterable and (r.path is not string) %}
      <div class="level-left">
        <label for="partition">This table is partitioned. Select a partition for preview:</label>
        <select id="partition" x-ref="{{ r.name }}Partition" @change="partitionChangedToggle = !partitionChangedToggle">
        {% for part in r.path %}
          {% set parsed_part = part.split('/')[-1].split('.')[0] %}
          <option value="/{{parsed_part}}">{{ parsed_part }}</option>
        {% endfor %}
        </select>
      </div>
      <div class="level-left">
        <span class="has-text-weight-bold has-text-warning">Note: some partitioned tables are quite large and may take several minutes to load a preview.</span>
      </div>
      {% endif %}
  </div>
  <div class="block">
      {% if current_user.is_authenticated or config['LOGIN_DISABLED'] %}
      <button class="button is-primary preview-button" :disabled="db === null" :class="{'is-loading': loading}"
        @click="showPreview = true; tableName = '{{r.name}}'">Preview / export as CSV</button>
      {% else %}
      <a class="button is-primary preview-button" href="/login?next_url={{ url_for(request.endpoint, **request.args) }}">Log
        in or sign up to preview / export as CSV</a>
      {% endif %}
      <a class="button is-link is-light"
        href="https://s3.us-west-2.amazonaws.com/pudl.catalyst.coop/nightly/{{ r.name }}.parquet">Download full table as
        Parquet</a>
    </div>
  {% endif %}
  <div class="level">
    {{r.description | safe}}
  </div>
  <div class="block">
    <details>
      <summary class="title is-5">Columns</summary>
      {% for col in r.columns %}
      <div class="mb-2" data-testid="column">
        <div>
          <strong>{{ col.name }}</strong>
        </div>
        <div class="pl-4">
          {{ col.description | safe }}
        </div>
      </div>
      {% endfor %}
    </details>
  </div>
</div>
{% endfor %}
